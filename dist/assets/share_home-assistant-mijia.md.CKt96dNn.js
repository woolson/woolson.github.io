import{_ as i,c as a,o as t,ae as n}from"./chunks/framework.Dgg8-8ov.js";const c=JSON.parse('{"title":"使用HomeAssistant连接米家和HomeKit","description":"使用HomeAssistant方案将不支持HomeKit米家设备和HomeKit进行连接，方便使用Siri控制","frontmatter":{"description":"使用HomeAssistant方案将不支持HomeKit米家设备和HomeKit进行连接，方便使用Siri控制","published":true,"title":"使用HomeAssistant连接米家和HomeKit"},"headers":[],"relativePath":"share/home-assistant-mijia.md","filePath":"share/home-assistant-mijia.md","lastUpdated":1751126425000}'),e={name:"share/home-assistant-mijia.md"};function l(h,s,p,o,k,r){return t(),a("div",null,s[0]||(s[0]=[n(`<p>作为一名数码爱好者，家里很多电器买的都是智能产品，这块的产品选择米家最经济实惠，但是自己使用的电脑和手机都是苹果的。最近买了个HomePod Mini，想通过Siri来控制家里的电器。</p><p>在之前有找过怎么在iOS家庭中控制米家生态设备，找到了很火的 <a href="https://www.home-assistant.io/" target="_blank" rel="noreferrer">Home Assistant</a> 就简单了解过 ，这次动手来实现他。</p><p>HomeAssistant支持各种设备，条件好的用树莓派，家里有旧电脑也可以实现，对设备性能要求不高。我家里有个台常年不关机的MacBookPro，所以就在Mac上安装了HomeAssistant服务。</p><p>这里不说教程网上一大堆（可以参考这个教程来将米家设备接入到 HomeAssistant：<a href="https://zhuanlan.zhihu.com/p/392587917%EF%BC%89%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%9D%A5%E8%AF%B4%E5%9C%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/392587917），主要来说在过程中遇到的问题。</a></p><h2 id="⭐️-完整的流程步骤" tabindex="-1">⭐️ 完整的流程步骤 <a class="header-anchor" href="#⭐️-完整的流程步骤" aria-label="Permalink to &quot;⭐️ 完整的流程步骤&quot;">​</a></h2><ol><li>配置环境安装Python</li><li>安装Home Assistant并启动</li><li>安装集成（integration）：HACS</li><li>通过HACS安装集成：XiaoMi Miot Auto</li><li>在XiaoMi Miot Auto中登录米家账号并选择需要接入的设备（这里会把米家App中的设备列表同步过来）</li><li>在Home Assistant中加入HomeKit同步到苹果家庭App中</li></ol><h2 id="环境问题-python" tabindex="-1">环境问题 - Python <a class="header-anchor" href="#环境问题-python" aria-label="Permalink to &quot;环境问题 - Python&quot;">​</a></h2><ul><li><code>Python</code>版本：按官方建议安装相对较新的版本，我装了最新的版本<code>3.10.1</code></li><li><code>Pip3</code>版本：按推荐也装了最新版本，我装了当前（2022.06.04）<code>22.1.2</code></li><li>安装切换Python源，<strong>在过程中需要安装大量依赖，防止等待时间过长</strong></li></ul><h2 id="启动homeassistant" tabindex="-1">启动HomeAssistant <a class="header-anchor" href="#启动homeassistant" aria-label="Permalink to &quot;启动HomeAssistant&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-dark github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">启动命令</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">→</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> hass</span></span></code></pre></div><p>第一次启动会安装很多的依赖资源，并且看教程其中会遇到各种问题，我这边只遇到了一个问题，就是由于权限问题无法自动安装依赖，报错后需要手动去安装。安装依赖注意一个问题，就是部分依赖是指定版本的。</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-dark github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"># 示例错误信息</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">Unable</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> to</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> install</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> package</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> getmac==0.8.2:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> ERROR:</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> Could</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> not</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> install</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> packages</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> due</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> to</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> OSError:...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"># getmac==0.8.2 就是指定版本，新开终端执行</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">→</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> pip3</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> install</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> getmac==</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">0.8.2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"># getmac&gt;=0.8.2需要大于这个版本，可以去GitHub搜这个包的版本列表选个指定版本的最后的fix版本或当前版本</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">→</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> pip3</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> install</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> getmac==</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">0.8.2</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">→</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> pip3</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> install</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> getmac==</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;">0.8.8</span></span></code></pre></div><h2 id="安装hacs" tabindex="-1">安装HACS <a class="header-anchor" href="#安装hacs" aria-label="Permalink to &quot;安装HACS&quot;">​</a></h2><p>这个就是类似第三方应用商店，安装注意以下问题：</p><ul><li>HomeAssistant平台搜不到HACS的话就手动安装</li><li>如果手动安装的话，选择HACS最新的版本下载</li><li>HomeAssistant在启动时报找不到HACS integration，需要在HACS配置文件（.homeassistant/custom_components/hacs/manifest.json）中加入版本，例如：<code>&quot;version&quot;: &quot;1.6.2&quot;</code></li><li>给HACS配置GitHub Token，<strong>创建Token的时候填名字和选择有效期即可，其他的不用勾选</strong></li></ul><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-dark github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"># 文本编辑器打开 ~/.homeassistant/configuration.yaml，上面是其他的配置，在最下面添加新行输入</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#85E89D;--shiki-light:#22863A;">hacs</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#85E89D;--shiki-light:#22863A;">  token</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">ghp_123123……</span></span></code></pre></div><h2 id="进程守护及开机自启" tabindex="-1">进程守护及开机自启 <a class="header-anchor" href="#进程守护及开机自启" aria-label="Permalink to &quot;进程守护及开机自启&quot;">​</a></h2><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-dark github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"># 安装自启</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">→</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> hass</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> --script</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> macos</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#6A737D;--shiki-light:#6A737D;"># 卸载自启</span></span>
<span class="line"><span style="--shiki-dark:#B392F0;--shiki-light:#6F42C1;">→</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> hass</span><span style="--shiki-dark:#79B8FF;--shiki-light:#005CC5;"> --script</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> macos</span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;"> uninstall</span></span></code></pre></div><p>如果安装自启的时候遇到以下问题，就<strong>先执行一下卸载自启再执行安装自启即可</strong>。</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-dark github-light vp-code" tabindex="0"><code><span class="line"><span>Load failed: 5: input/output error</span></span>
<span class="line"><span>Try running \`launchctl bootstrap\` as root for richer errors</span></span></code></pre></div><h2 id="连接homeassistant和家庭app" tabindex="-1">连接HomeAssistant和家庭App <a class="header-anchor" href="#连接homeassistant和家庭app" aria-label="Permalink to &quot;连接HomeAssistant和家庭App&quot;">​</a></h2><p>在配置文件<code>~/.homeassistant/configuration.yaml</code> 最下面新行输入</p><div class="language-yaml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-dark github-light vp-code" tabindex="0"><code><span class="line"><span style="--shiki-dark:#85E89D;--shiki-light:#22863A;">hacs</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">:</span></span>
<span class="line"><span style="--shiki-dark:#85E89D;--shiki-light:#22863A;">  token</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">: </span><span style="--shiki-dark:#9ECBFF;--shiki-light:#032F62;">ghp_123123……</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-dark:#85E89D;--shiki-light:#22863A;">homekit</span><span style="--shiki-dark:#E1E4E8;--shiki-light:#24292E;">:</span></span></code></pre></div><p>添加好配置，重启Home Assistant后，在HomeAssistant的通知里面会有HomeKit的连接二维码，使用家庭App扫码添加即可。</p><h2 id="homeassistant可以控制设备-但家庭中设备显示未响应" tabindex="-1">HomeAssistant可以控制设备，但家庭中设备显示<strong>未响应</strong> <a class="header-anchor" href="#homeassistant可以控制设备-但家庭中设备显示未响应" aria-label="Permalink to &quot;HomeAssistant可以控制设备，但家庭中设备显示**未响应**&quot;">​</a></h2><p>在网上找了很多问题原因后，基本上问题原因都是指向路由器问题，例如：<a href="https://bbs.hassbian.com/thread-1561-1-1.html" target="_blank" rel="noreferrer">https://bbs.hassbian.com/thread-1561-1-1.html</a> 我家里的路由器是华为AX3Pro，经过一番查找后发现路由器有个设置叫<strong>WiFi5备用网络（提升网络兼容性的）</strong>，打开后问题立马解决了。</p>`,26)]))}const g=i(e,[["render",l]]);export{c as __pageData,g as default};
